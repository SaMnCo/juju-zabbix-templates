# add time_raw field for openstack log except horizon(apache)
<match reform_time.**>
    type record_reformer
    enable_ruby true
    <record>
       time_raw ${time.strftime('%Y-%m-%d %H:%M:%S')}.${msec}
       </record>
    tag reform_openstack.${tag_suffix[1]}
</match>

# add several other fields for all openstack log
<match reform_openstack.**>
type record_reformer
tag openstack.${tag_suffix[1]}
enable_ruby true
<record>
   hostname ${hostname}
   COMPONENT ${tag_parts[1]}
   logfile ${tag_suffix[2]}
   </record>
</match>

<match openstack.**>
  type forward
  flush_interval 10s
  <server>
    host {{fluentd_collector_ip}}
    port  {{fluentd_collector_port}}
  </server>
  buffer_type file
  buffer_path /var/log/fluent/openstack*.buffer
  buffer_chunk_limit 512k
  buffer_queue_limit 256
  retry_wait 10s
  retry_limit 5  
</match>
